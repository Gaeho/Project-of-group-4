<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SrComMypageDao">

	<select id="SrComTotal" resultType="int">
		select count(*)
		from company
	</select>
	
	<select id="SrComInfo" resultType="CommCompany">
		select company.com_id, company.com_name, company.com_addr, company.com_web, company.com_regnum, company.com_email, 
		company.com_mgr_tel, company.com_tel, company.com_bus, company.com_img, comm.*
		from company, comm
		where company.com_sec=comm.sub_cat
		and company.com_id='znvkd323'
		and comm.main_cat='050'
	</select>
	
	<select id="SrComAnnReg" parameterType="Announce" resultType="Announce">
	<![CDATA[
		select *
		from 
    		(
    		 select rownum rn, z.*
    		 from ( 
    		 		select * 
			 		from announce
			 		where ANNO_C_REGDATE > sysdate
			 		and com_id = 'tlstprp5184'
			 	   ) z
    		 )
		where rn between #{start} and #{end}
		]]>
	</select>
	
	<select id="SrComAnnCReg" parameterType="Announce" resultType="Announce">
		<![CDATA[
		select *
		from 
    		(
    		 select rownum rn, z.*
    		 from ( 
    		 		select * 
			 		from announce
			 		where ANNO_C_REGDATE < sysdate
			 		and com_id = 'tlstprp5184'
			       ) z
    		 )
		where rn between #{start} and #{end}    		 
		]]>
	</select>
	
	<select id="SrAppAnnMemReg" parameterType="AppAnnMem" resultType="AppAnnMem">
		<![CDATA[
		select *
		from 
		    (
		     select rownum rn, z.*
		     from ( 
		     		select m.user_id, m.user_img, a.app_regdate, an.anno_c_regdate, an.anno_regdate, an.anno_code, a.res_code
		            from member m, apply a, announce an
		            where m.user_id = a.user_id
		            and a.anno_code = an.anno_code 
		            and an.com_id = 'tlstprp5184'
		            and ANNO_C_REGDATE > sysdate 
		           ) z
		    )
		where rn between #{start} and #{end} 
		]]>
	</select>
	
	<select id="SrAppAnnMemCReg" parameterType="AppAnnMem" resultType="AppAnnMem">
		<![CDATA[
		select *
		from 
		    (
		     select rownum rn, z.*
		     from (
		            select m.user_id, m.user_img, a.app_regdate, an.anno_c_regdate, an.anno_regdate, an.anno_code, a.res_code
		            from member m, apply a, announce an
		            where m.user_id = a.user_id
		            and a.anno_code = an.anno_code 
		            and an.com_id = 'tlstprp5184'
		            and ANNO_C_REGDATE < sysdate
		           ) z
		     )
		where rn between #{start} and #{end} 
		]]>
	</select>
	<select id="SrBmarkList" parameterType="MemBmark" resultType="MemBmark">
		select *
		from 
    		(
    		 select rownum rn, a.*
    		 from (select b.com_id, m.user_img, b.user_id, b.mrk_date
                    from member m, bookmark b
                    where m.user_id = b.user_id
                    and b.com_id = 'tlstprp5184') a
    		        )
		where rn between #{start} and #{end}
	</select>
	
	<select id="SrUserDetail" parameterType="String" resultType="CommMemResume">
		
		select r.* , m.*
		from resume r, member m
		where r.user_id = m.user_id
		and r.user_id = #{user_id}
		and r.rep_res = '1'
	</select>
	
	<select id="SrJobTag" parameterType="CommMemResume" resultType="Comm">
		select distinct c.comm_ctx
		from member m
		inner join comm c
		on m.user_job_tag = c.sub_cat
		where main_cat = 001
		and m.user_job_tag = #{user_job_tag}
	</select>
	
	<select id="SrGetInfo" parameterType="Bookmark" resultType="int">
		select count(*)
		from bookmark 
		where com_id = #{com_id}
		and user_id = #{user_id}
	</select>
	
	<insert id="SrBminsert" parameterType="Bookmark">
		insert into bookmark 
		values (#{com_id},#{user_id},1,sysdate)
	</insert>
	
	<delete id="SrBmdelete" parameterType="Bookmark">
		delete from bookmark 
		where com_id = #{com_id} 
		and user_id = #{user_id}
	</delete>
	
	<select id="SrHsmjr" parameterType="CommMemResume" resultType="Comm">
		select distinct c.comm_ctx
		from resume r
		inner join comm c
		on r.hs_mjr = c.sub_cat
		where main_cat = '062'
		and r.hs_mjr = #{hs_mjr}
	</select>
	
	<select id="SrRestag1" parameterType="CommMemResume" resultType="Comm">
		select distinct c.comm_ctx
		from resume r
		inner join comm c
		on r.res_tag1 = c.sub_cat
		where main_cat = '002'
		and r.res_tag1 = #{res_tag1}
	</select>
	
	<select id="SrRestag2" parameterType="CommMemResume" resultType="Comm">
		select distinct c.comm_ctx
		from resume r
		inner join comm c
		on r.res_tag2 = c.sub_cat
		where main_cat = '002'
		and r.res_tag2 = #{res_tag2}
	</select>
	
	<select id="SrRestag3" parameterType="CommMemResume" resultType="Comm">
		select distinct c.comm_ctx
		from resume r
		inner join comm c
		on r.res_tag3 = c.sub_cat
		where main_cat = '002'
		and r.res_tag3 = #{res_tag3}
	</select>
	
	
	<!-- 열람이력 확인~ -->
	<select id="SrFindRC" parameterType="ResumeContect" resultType="ResumeContect">
		select * from resume_contect
		where user_id=#{user_id} and res_code=#{res_code} and com_id=#{com_id}
	</select>
	
	<!-- 이력서열람 추가요-->
	<insert id="SrResumeContectInsert" parameterType="ResumeContect">
		insert into Resume_Contect 
		values(#{com_id},#{user_id},#{res_code},sysdate,not_seq.nextval)
	</insert>
	
	<!-- 알림추가요~ -->
	<insert id="SrInsertNotice" parameterType="Notice">
		insert into notice
		values(#{ntc_code},#{user_id},#{anno_code},#{ntc_ctg})
	</insert>
	
	<select id="SrMemResumeBmarkList" parameterType="MemResumeBmark" resultType="MemResumeBmark">
		select mem.user_id, mem.user_img, res.RES_DATE,res.res_code,bmark.com_id, bmark.MRK_DATE, 
		bmark.IT_BOOKMARK, res.RES_TITLE
		from member mem
		left JOIN RESUME res
		on mem.user_id=res.user_id
		left join bookmark bmark
		on mem.user_id=bmark.user_id
		where res.res_title like '%'||#{keyword1}||'%'
    	and bmark.com_id='tkstjd234'
	</select>
	
	
	
	
	
	
	
	
	
	
	
	
</mapper>